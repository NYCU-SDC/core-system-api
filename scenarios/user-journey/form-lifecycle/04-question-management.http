# ============================================
# Phase 4: Question Management - Create All Question Types
# ============================================
# This file creates all 12 non-OAuth question types (OAuth excluded as per requirements):
# 1. SHORT_TEXT
# 2. LONG_TEXT
# 3. SINGLE_CHOICE
# 4. MULTIPLE_CHOICE
# 5. DROPDOWN
# 6. DETAILED_MULTIPLE_CHOICE
# 7. DATE
# 8. UPLOAD_FILE
# 9. LINEAR_SCALE
# 10. RATING
# 11. RANKING
# 12. HYPERLINK

# Import setup from Phase 3
# @import ./03-workflow-basic.http

###

# ============================================
# Create Question 1: SHORT_TEXT
# ============================================
# @name createShortTextQuestion
# @ref getFinalWorkflow
POST {{BASE_URL}}/sections/{{sectionNodeId}}/questions
Content-Type: application/json

{
    "required": true,
    "type": "SHORT_TEXT",
    "title": "What is your full name?",
    "description": "Please enter your first and last name",
    "order": 1
}

{{
    test.status(201);
    test.hasResponseBody();

    const { equal } = require('assert');

    test('Short text question created', () => {
        const data = JSON.parse(response.body);
        equal(data.id !== undefined, true, 'Question ID should exist');
        equal(data.type, 'SHORT_TEXT', 'Type should be SHORT_TEXT');
        equal(data.title, 'What is your full name?', 'Title should match');
        equal(data.required, true, 'Required should be true');
        equal(data.sectionId, sectionNodeId, 'Section ID should match');
        
        console.log('Created SHORT_TEXT question:', data.id);
    });

    const data = JSON.parse(response.body);
    exports.shortTextQuestionId = data.id;
}}

###

# ============================================
# Create Question 2: LONG_TEXT
# ============================================
# @name createLongTextQuestion
# @ref createShortTextQuestion
POST {{BASE_URL}}/sections/{{sectionNodeId}}/questions
Content-Type: application/json

{
    "required": true,
    "type": "LONG_TEXT",
    "title": "Tell us about your background",
    "description": "Please share your educational background and work experience (maximum 500 words)",
    "order": 2
}

{{
    test.status(201);
    test.hasResponseBody();

    const { equal } = require('assert');

    test('Long text question created', () => {
        const data = JSON.parse(response.body);
        equal(data.id !== undefined, true, 'Question ID should exist');
        equal(data.type, 'LONG_TEXT', 'Type should be LONG_TEXT');
        equal(data.required, true, 'Required should be true');
        
        console.log('Created LONG_TEXT question:', data.id);
    });

    const data = JSON.parse(response.body);
    exports.longTextQuestionId = data.id;
}}

###

# ============================================
# Create Question 3: SINGLE_CHOICE
# ============================================
# @name createSingleChoiceQuestion
# @ref createLongTextQuestion
POST {{BASE_URL}}/sections/{{sectionNodeId}}/questions
Content-Type: application/json

{
    "required": true,
    "type": "SINGLE_CHOICE",
    "title": "What is your preferred work location?",
    "description": "Select one option that best describes your preference",
    "order": 3,
    "choices": [
        { "name": "Remote" },
        { "name": "On-site" },
        { "name": "Hybrid" }
    ]
}

{{
    test.status(201);
    test.hasResponseBody();

    const { equal } = require('assert');

    test('Single choice question created', () => {
        const data = JSON.parse(response.body);
        equal(data.id !== undefined, true, 'Question ID should exist');
        equal(data.type, 'SINGLE_CHOICE', 'Type should be SINGLE_CHOICE');
        equal(Array.isArray(data.choices), true, 'Choices should be an array');
        equal(data.choices.length, 3, 'Should have 3 choices');
        
        console.log('Created SINGLE_CHOICE question:', data.id);
    });

    const data = JSON.parse(response.body);
    exports.singleChoiceQuestionId = data.id;
    exports.singleChoiceOptions = data.choices;
}}

###

# ============================================
# Create Question 4: MULTIPLE_CHOICE
# ============================================
# @name createMultipleChoiceQuestion
# @ref createSingleChoiceQuestion
POST {{BASE_URL}}/sections/{{sectionNodeId}}/questions
Content-Type: application/json

{
    "required": true,
    "type": "MULTIPLE_CHOICE",
    "title": "Which programming languages do you know?",
    "description": "Select all that apply",
    "order": 4,
    "choices": [
        { "name": "JavaScript" },
        { "name": "TypeScript" },
        { "name": "Python" },
        { "name": "Go" },
        { "name": "Rust" }
    ]
}

{{
    test.status(201);
    test.hasResponseBody();

    const { equal } = require('assert');

    test('Multiple choice question created', () => {
        const data = JSON.parse(response.body);
        equal(data.id !== undefined, true, 'Question ID should exist');
        equal(data.type, 'MULTIPLE_CHOICE', 'Type should be MULTIPLE_CHOICE');
        equal(Array.isArray(data.choices), true, 'Choices should be an array');
        equal(data.choices.length, 5, 'Should have 5 choices');
        
        console.log('Created MULTIPLE_CHOICE question:', data.id);
    });

    const data = JSON.parse(response.body);
    exports.multipleChoiceQuestionId = data.id;
    exports.multipleChoiceOptions = data.choices;
}}

###

# ============================================
# Create Question 5: DROPDOWN
# ============================================
# @name createDropdownQuestion
# @ref createMultipleChoiceQuestion
POST {{BASE_URL}}/sections/{{sectionNodeId}}/questions
Content-Type: application/json

{
    "required": false,
    "type": "DROPDOWN",
    "title": "What is your experience level?",
    "description": "Choose from the dropdown menu",
    "order": 5,
    "choices": [
        { "name": "Beginner (0-1 years)" },
        { "name": "Intermediate (1-3 years)" },
        { "name": "Advanced (3-5 years)" },
        { "name": "Expert (5+ years)" }
    ]
}

{{
    test.status(201);
    test.hasResponseBody();

    const { equal } = require('assert');

    test('Dropdown question created', () => {
        const data = JSON.parse(response.body);
        equal(data.id !== undefined, true, 'Question ID should exist');
        equal(data.type, 'DROPDOWN', 'Type should be DROPDOWN');
        equal(data.required, false, 'Required should be false');
        equal(Array.isArray(data.choices), true, 'Choices should be an array');
        equal(data.choices.length, 4, 'Should have 4 choices');
        
        console.log('Created DROPDOWN question:', data.id);
    });

    const data = JSON.parse(response.body);
    exports.dropdownQuestionId = data.id;
    exports.dropdownOptions = data.choices;
}}

###

# ============================================
# Create Question 6: DETAILED_MULTIPLE_CHOICE
# ============================================
# @name createDetailedMultipleChoiceQuestion
# @ref createDropdownQuestion
POST {{BASE_URL}}/sections/{{sectionNodeId}}/questions
Content-Type: application/json

{
    "required": true,
    "type": "DETAILED_MULTIPLE_CHOICE",
    "title": "Which technologies are you interested in?",
    "description": "Select all areas that interest you",
    "order": 6,
    "choices": [
        { 
            "name": "Frontend Development", 
            "description": "React, Vue, Angular, and modern UI frameworks" 
        },
        { 
            "name": "Backend Development", 
            "description": "Node.js, Go, Python, and server-side technologies" 
        },
        { 
            "name": "DevOps", 
            "description": "CI/CD, Docker, Kubernetes, cloud infrastructure" 
        },
        { 
            "name": "Data Science", 
            "description": "Machine learning, data analysis, and AI" 
        }
    ]
}

{{
    test.status(201);
    test.hasResponseBody();

    const { equal } = require('assert');

    test('Detailed multiple choice question created', () => {
        const data = JSON.parse(response.body);
        equal(data.id !== undefined, true, 'Question ID should exist');
        equal(data.type, 'DETAILED_MULTIPLE_CHOICE', 'Type should be DETAILED_MULTIPLE_CHOICE');
        equal(Array.isArray(data.choices), true, 'Choices should be an array');
        equal(data.choices.length, 4, 'Should have 4 choices');
        
        // Verify descriptions exist
        const hasDescriptions = data.choices.every(c => c.description !== undefined && c.description !== '');
        equal(hasDescriptions, true, 'All choices should have descriptions');
        
        console.log('Created DETAILED_MULTIPLE_CHOICE question:', data.id);
    });

    const data = JSON.parse(response.body);
    exports.detailedMultipleChoiceQuestionId = data.id;
    exports.detailedMultipleChoiceOptions = data.choices;
}}

###

# ============================================
# Create Question 7: DATE
# ============================================
# @name createDateQuestion
# @ref createDetailedMultipleChoiceQuestion
POST {{BASE_URL}}/sections/{{sectionNodeId}}/questions
Content-Type: application/json

{
    "required": true,
    "type": "DATE",
    "title": "When can you start?",
    "description": "Please select your preferred start date",
    "order": 7,
    "date": {
        "hasYear": true,
        "hasMonth": true,
        "hasDay": true,
        "minDate": "2024-01-01T00:00:00Z",
        "maxDate": "2026-12-31T23:59:59Z"
    }
}

{{
    test.status(201);
    test.hasResponseBody();

    const { equal } = require('assert');

    test('Date question created', () => {
        const data = JSON.parse(response.body);
        equal(data.id !== undefined, true, 'Question ID should exist');
        equal(data.type, 'DATE', 'Type should be DATE');
        equal(data.required, true, 'Required should be true');
        equal(data.date !== undefined, true, 'Date options should exist');
        equal(data.date.hasYear, true, 'hasYear should be true');
        equal(data.date.hasMonth, true, 'hasMonth should be true');
        equal(data.date.hasDay, true, 'hasDay should be true');
        equal(data.date.minDate, '2024-01-01T00:00:00Z', 'minDate should match');
        equal(data.date.maxDate, '2026-12-31T23:59:59Z', 'maxDate should match');
        
        console.log('Created DATE question:', data.id);
    });

    const data = JSON.parse(response.body);
    exports.dateQuestionId = data.id;
}}

###

# ============================================
# Create Question 8: UPLOAD_FILE
# ============================================
# @name createUploadFileQuestion
# @ref createDateQuestion
POST {{BASE_URL}}/sections/{{sectionNodeId}}/questions
Content-Type: application/json

{
    "required": false,
    "type": "UPLOAD_FILE",
    "title": "Upload your resume/CV",
    "description": "Please upload your resume in PDF or Word format",
    "order": 8,
    "uploadFile": {
        "allowedFileTypes": ["PDF", "DOC", "DOCX"],
        "maxFileAmount": 1,
        "maxFileSizeLimit": 1000000
    }
}

{{
    test.status(201);
    test.hasResponseBody();

    const { equal } = require('assert');

    test('Upload file question created', () => {
        const data = JSON.parse(response.body);
        equal(data.id !== undefined, true, 'Question ID should exist');
        equal(data.type, 'UPLOAD_FILE', 'Type should be UPLOAD_FILE');
        equal(data.required, false, 'Required should be false');
        equal(data.uploadFile !== undefined, true, 'Upload file options should exist');
        equal(Array.isArray(data.uploadFile.allowedFileTypes), true, 'Allowed file types should be an array');
        equal(data.uploadFile.maxFileAmount, 1, 'Max file amount should be 1');
        equal(data.uploadFile.maxFileSizeLimit, 1000000, 'Max file size limit should be 1000000 bytes');
        
        console.log('Created UPLOAD_FILE question:', data.id);
    });

    const data = JSON.parse(response.body);
    exports.uploadFileQuestionId = data.id;
}}

###

# ============================================
# Create Question 9: LINEAR_SCALE
# ============================================
# @name createLinearScaleQuestion
# @ref createUploadFileQuestion
POST {{BASE_URL}}/sections/{{sectionNodeId}}/questions
Content-Type: application/json

{
    "required": true,
    "type": "LINEAR_SCALE",
    "title": "Rate your proficiency in TypeScript",
    "description": "On a scale of 1 to 10, how proficient are you?",
    "order": 9,
    "scale": {
        "minVal": 1,
        "maxVal": 10,
        "minValueLabel": "Beginner",
        "maxValueLabel": "Expert"
    }
}

{{
    test.status(201);
    test.hasResponseBody();

    const { equal } = require('assert');

    test('Linear scale question created', () => {
        const data = JSON.parse(response.body);
        equal(data.id !== undefined, true, 'Question ID should exist');
        equal(data.type, 'LINEAR_SCALE', 'Type should be LINEAR_SCALE');
        equal(data.required, true, 'Required should be true');
        equal(data.scale !== undefined, true, 'Scale options should exist');
        equal(data.scale.minVal, 1, 'Min value should be 1');
        equal(data.scale.maxVal, 10, 'Max value should be 10');
        
        console.log('Created LINEAR_SCALE question:', data.id);
    });

    const data = JSON.parse(response.body);
    exports.linearScaleQuestionId = data.id;
}}

###

# ============================================
# Create Question 10: RATING
# ============================================
# @name createRatingQuestion
# @ref createLinearScaleQuestion
POST {{BASE_URL}}/sections/{{sectionNodeId}}/questions
Content-Type: application/json

{
    "required": true,
    "type": "RATING",
    "title": "How satisfied are you with your current role?",
    "description": "Rate your satisfaction level using stars",
    "order": 10,
    "scale": {
        "icon": "star",
        "minVal": 1,
        "maxVal": 5
    }
}

{{
    test.status(201);
    test.hasResponseBody();

    const { equal } = require('assert');

    test('Rating question created', () => {
        const data = JSON.parse(response.body);
        equal(data.id !== undefined, true, 'Question ID should exist');
        equal(data.type, 'RATING', 'Type should be RATING');
        equal(data.required, true, 'Required should be true');
        equal(data.scale !== undefined, true, 'Scale options should exist');
        equal(data.scale.icon, 'star', 'Icon should be star');
        equal(data.scale.minVal, 1, 'Min value should be 1');
        equal(data.scale.maxVal, 5, 'Max value should be 5');
        
        console.log('Created RATING question:', data.id);
    });

    const data = JSON.parse(response.body);
    exports.ratingQuestionId = data.id;
}}

###

# ============================================
# Create Question 11: RANKING (with sourceId from single choice)
# ============================================
# @name createRankingQuestion
# @ref createRatingQuestion
POST {{BASE_URL}}/sections/{{sectionNodeId}}/questions
Content-Type: application/json

{
    "required": true,
    "type": "RANKING",
    "title": "Rank your work location preferences",
    "description": "Order the options based on your preference (most preferred first)",
    "order": 11,
    "choices": [
        { "name": "Remote" },
        { "name": "On-site" },
        { "name": "Hybrid" }
    ]
}

{{
    test.status(201);
    test.hasResponseBody();

    const { equal } = require('assert');

    test('Ranking question created', () => {
        const data = JSON.parse(response.body);
        equal(data.id !== undefined, true, 'Question ID should exist');
        equal(data.type, 'RANKING', 'Type should be RANKING');
        equal(data.required, true, 'Required should be true');
        equal(data.choices.length, 3, 'Should have 3 choices');
        equal(data.choices[0].name, 'Remote', 'First choice should be Remote');
        equal(data.choices[1].name, 'On-site', 'Second choice should be On-site');
        equal(data.choices[2].name, 'Hybrid', 'Third choice should be Hybrid');
        
        console.log('Created RANKING question:', data.id);
    });

    const data = JSON.parse(response.body);
    exports.rankingQuestionId = data.id;
    exports.rankingOptions = data.choices;
}}

###

# ============================================
# Create Question 12: HYPERLINK
# ============================================
# @name createHyperlinkQuestion
# @ref createRankingQuestion
POST {{BASE_URL}}/sections/{{sectionNodeId}}/questions
Content-Type: application/json

{
    "required": false,
    "type": "HYPERLINK",
    "title": "Portfolio or personal website",
    "description": "Please provide a link to your portfolio, GitHub, or LinkedIn profile",
    "order": 12
}

{{
    test.status(201);
    test.hasResponseBody();

    const { equal } = require('assert');

    test('Hyperlink question created', () => {
        const data = JSON.parse(response.body);
        equal(data.id !== undefined, true, 'Question ID should exist');
        equal(data.type, 'HYPERLINK', 'Type should be HYPERLINK');
        equal(data.required, false, 'Required should be false');
        
        console.log('Created HYPERLINK question:', data.id);
    });

    const data = JSON.parse(response.body);
    exports.hyperlinkQuestionId = data.id;
}}

###

# ============================================
# Create Question HYPERLINK That Need To Delete
# ============================================
# @name createHyperlinkQuestionToDelete
# @ref createHyperlinkQuestion
POST {{BASE_URL}}/sections/{{sectionNodeId}}/questions
Content-Type: application/json

{
    "required": false,
    "type": "HYPERLINK",
    "title": "Need to delete this question",
    "description": "Please provide a link to your portfolio, GitHub, or LinkedIn profile",
    "order": 13
}

{{
    test.status(201);
    test.hasResponseBody();

    const { equal } = require('assert');

    test('Hyperlink question created', () => {
        const data = JSON.parse(response.body);
        equal(data.id !== undefined, true, 'Question ID should exist');
        equal(data.type, 'HYPERLINK', 'Type should be HYPERLINK');
        equal(data.required, false, 'Required should be false');
        
        console.log('Created HYPERLINK question:', data.id);
    });

    const data = JSON.parse(response.body);
    exports.hyperlinkQuestionToDeleteId = data.id;
}}

###

# ============================================
# List All Questions in Section
# ============================================
# @name listQuestionsInSection
# @ref createHyperlinkQuestionToDelete
GET {{BASE_URL}}/forms/{{formId}}/sections

{{
    test.status(200);
    test.hasResponseBody();

    const { equal } = require('assert');

    test('All questions created successfully', () => {
        const data = JSON.parse(response.body);
        equal(Array.isArray(data), true, 'Response should be an array');
        equal(data.length > 0, true, 'Should have at least one section');
        
        // Find our section
        const ourSection = data.find(s => s.section.id === sectionNodeId);
        equal(ourSection !== undefined, true, 'Our section should exist');
        equal(Array.isArray(ourSection.questions), true, 'Questions should be an array');
        equal(ourSection.questions.length, 13, 'Should have 13 questions, but got ' + ourSection.questions.length);
    });
}}

###

# ============================================
# Update Question - Test Update Operation
# ============================================
# @name updateShortTextQuestion
# @ref listQuestionsInSection
PUT {{BASE_URL}}/sections/{{sectionNodeId}}/questions/{{shortTextQuestionId}}
Content-Type: application/json

{
    "required": false,
    "type": "SHORT_TEXT",
    "title": "What is your full name? (Updated)",
    "description": "Please enter your first and last name - this field is now optional",
    "order": 1
}

{{
    test.status(200);
    test.hasResponseBody();

    const { equal } = require('assert');

    test('Question updated successfully', () => {
        const data = JSON.parse(response.body);
        equal(data.id, shortTextQuestionId, 'Question ID should match');
        equal(data.type, 'SHORT_TEXT', 'Type should remain SHORT_TEXT');
        equal(data.title, 'What is your full name? (Updated)', 'Title should be updated');
        equal(data.required, false, 'Required should be updated to false');
        
        console.log('Updated question:', data.id);
    });
}}

###

# ============================================
# Delete Question - Test Delete Operation
# ============================================
# @name deleteHyperlinkQuestion
# @ref updateShortTextQuestion
DELETE {{BASE_URL}}/sections/{{sectionNodeId}}/questions/{{hyperlinkQuestionToDeleteId}}

{{
    test.status(204);
    
    console.log('Deleted HYPERLINK question:', hyperlinkQuestionToDeleteId);
}}

###

# ============================================
# Verify Question Deletion
# ============================================
# @name verifyQuestionDeletion
# @ref deleteHyperlinkQuestion
GET {{BASE_URL}}/forms/{{formId}}/sections

{{
    test.status(200);
    test.hasResponseBody();

    const { equal } = require('assert');

    test('Question deletion verified', () => {
        const data = JSON.parse(response.body);
        
        // Find our section
        const ourSection = data.find(s => s.section.id === sectionNodeId);
        equal(ourSection !== undefined, true, 'Our section should exist');
        equal(Array.isArray(ourSection.questions), true, 'Questions should be an array');
        equal(ourSection.questions.length, 12, 'Should now have 12 questions (after deletion) but got ' + ourSection.questions.length);
        
        // Verify the deleted question is not in the list
        const deletedQuestion = ourSection.questions.find(q => q.id === hyperlinkQuestionToDeleteId);
        equal(deletedQuestion, undefined, 'Deleted question should not exist');
        
        console.log('Question count after deletion:', ourSection.questions.length);
    });
}}
